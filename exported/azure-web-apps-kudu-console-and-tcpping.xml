<?xml version="1.0" encoding="utf-8"?>
<post>
  <id>fd91132f-63dd-4673-8776-0d6938e9a758</id>
  <title>Azure Web Apps, Kudu Console and TcpPing</title>
  <slug>azure-web-apps-kudu-console-and-tcpping</slug>
  <shortUrl>http://bit.ly/1DxpDiH</shortUrl>
  <author></author>
  <pubDate>2015-08-06 20:32:53</pubDate>
  <lastModified>2016-03-31 17:31:41</lastModified>
  <content>&lt;p&gt;I was working with a customer recently that put a website into Azure Web Apps. This site needed to connect to their backend databases (which they couldn’t move to Azure because legacy systems still needed to connect to it). We created an Azure VNet and configured site-to-site connectivity that created a secure connection between the Azure VNet and their on-premises network.&lt;/p&gt; &lt;p&gt;We then had to configure point-to-site connections for the VNet &lt;a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-integrate-with-vnet/" target="_blank"&gt;so that we could put the Azure Web App onto the VNet&lt;/a&gt;. This would (in theory) allow the website to access their on-premises resources such as the database. We also had to upgrade the site to Standard pricing in order to do this.&lt;/p&gt; &lt;p&gt;We had to reconfigure the site-to-site gateway to allow dynamic routing in order to do this, which meant deleting and recreating the gateway. A bit of a pain, but not too bad. We then configured static routing from the on-premises network to the point-to-site addresses on the VNet.&lt;/p&gt; &lt;h2&gt;Ping from Azure Web App?&lt;/h2&gt; &lt;p&gt;Once we had that all configured, we wanted to test connectivity. If we had deployed a VM, it would have been simple – just open a cmd prompt and ping away. However, we didn’t have a server, since we were deploying an Azure Web App. So initially we deployed a dummy Azure Web App onto the VNet to test the connection. This became a little bit of a pain. However, I remembered reading about Kudu and decided to see if that would be easier.&lt;/p&gt; &lt;h2&gt;Kudu to the Rescue&lt;/h2&gt; &lt;p&gt;If you browse to &lt;a href="http://&amp;lt;yoursite&amp;gt;.scm.azurewebsites.net"&gt;http://&amp;lt;yoursite&amp;gt;.scm.azurewebsites.net&lt;/a&gt; (where &amp;lt;yoursite&amp;gt; is the name of your Azure Web App) then you’ll see the Kudu site.&lt;/p&gt; &lt;p&gt;&lt;a href="http://colinsalmcorner.com/posts/files/282b101d-ea87-4453-a22b-8e95a23c236d.png"&gt;&lt;img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; float: none; margin-left: auto; border-left: 0px; display: block; margin-right: auto" border="0" alt="image" src="http://colinsalmcorner.com/posts/files/9d0dc450-7511-4540-901c-a39b7bf74d4b.png" width="338" height="200"&gt;&lt;/a&gt; &lt;/p&gt; &lt;p&gt;Once you’ve opened the Kudu site, you can do all sorts of interesting things (see &lt;a href="http://blogs.msdn.com/b/benjaminperkins/archive/2014/03/24/using-kudu-with-windows-azure-web-sites.aspx" target="_blank"&gt;this blog post&lt;/a&gt; and this &lt;a href="https://channel9.msdn.com/Shows/Azure-Friday/What-is-Kudu-Azure-Web-Sites-Deployment-with-David-Ebbo" target="_blank"&gt;Scott Hanselman and David Ebbo video&lt;/a&gt;). If you open the Debug console (you can go CMD or PowerShell) then you get to play! I opened the CMD console and typed “help” – to my surprise I got a list of commands I could run:&lt;/p&gt; &lt;p&gt;&lt;a href="http://colinsalmcorner.com/posts/files/01756426-fddc-496c-92c3-1e9924ede690.png"&gt;&lt;img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; float: none; margin-left: auto; border-left: 0px; display: block; margin-right: auto" border="0" alt="image" src="http://colinsalmcorner.com/posts/files/bd5c54ff-2e65-4319-94a0-99d7381a4a6f.png" width="312" height="223"&gt;&lt;/a&gt; &lt;/p&gt; &lt;p&gt;Unfortunately I didn’t see anything that would help me with testing connectivity. However, I remembered that I had read &lt;em&gt;somewhere&lt;/em&gt; about the command “tpcping”. So I tried it:&lt;/p&gt; &lt;p&gt;&lt;font size="3" face="Courier New"&gt;tcpping &amp;lt;enter&amp;gt;&lt;/font&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="http://colinsalmcorner.com/posts/files/9c7294f7-0294-40f4-832f-bc91f69dd34f.png"&gt;&lt;img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; float: none; margin-left: auto; border-left: 0px; display: block; margin-right: auto" border="0" alt="image" src="http://colinsalmcorner.com/posts/files/cf213b2f-ce32-45e9-ad58-9784cc048915.png" width="318" height="119"&gt;&lt;/a&gt; Looks promising! Even better than the “ping” command, you can also test for a specific port, not just the ip address. So I want to test if my site can reach my database server on port 1443, no problem:&lt;/p&gt; &lt;p&gt;&lt;font size="3" face="Courier New"&gt;tcpping 192.168.0.1:1443 &amp;lt;enter&amp;gt;&lt;/font&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="http://colinsalmcorner.com/posts/files/00312b65-b46a-49ce-9414-b9411175fa4e.png"&gt;&lt;img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; float: none; margin-left: auto; border-left: 0px; display: block; margin-right: auto" border="0" alt="image" src="http://colinsalmcorner.com/posts/files/e613500b-5d37-4a2c-90d5-6884dd4ff870.png" width="345" height="290"&gt;&lt;/a&gt; Hmm, seems that address isn’t working.&lt;/p&gt; &lt;p&gt;After troubleshooting for a while, we managed to sort the problem and tcpping gave us a nice “Success” message, so we knew we were good to go. Kudu saved us a lot of time!&lt;/p&gt; &lt;p&gt;Happy troubleshooting!&lt;/p&gt;</content>
  <ispublished>true</ispublished>
  <categories>
    <category>Cloud</category>
  </categories>
  <comments>
    <comment isAdmin="false" isApproved="true" id="d079e31f-5988-4df7-8a29-d57f09e1cafe">
      <author>pbenemy</author>
      <email>pbenemy@gmail.com</email>
      <website></website>
      <ip>206.169.71.79</ip>
      <userAgent>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.155 Safari/537.36</userAgent>
      <date>2015-08-17 23:5:39</date>
      <content>Hi Colin. I was hoping you could shed some light on the troubleshooting you tried at the end. I&amp;#39;m in the same situation. I created a VM and joined it to the vnet to troubleshoot. The VM can talk to the web app through p2s and can also talk to our on prem network through s2s... but the web app can&amp;#39;t access the on prem network. Tcpping the local on prem gateway times out.</content>
    </comment>
    <comment isAdmin="true" isApproved="true" id="dc962dfd-73ff-455f-a04c-75a251e8e66b">
      <author>Colin Dembovsky</author>
      <email>colindembovsky@gmail.com</email>
      <website>http://colinsalmcorner.com/</website>
      <ip>105.226.94.153</ip>
      <userAgent>Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; Touch; rv:11.0) like Gecko</userAgent>
      <date>2015-09-21 07:25:37</date>
      <content>@pbenemy&lt;br /&gt;&lt;br /&gt;The only other thing I can think of is that you should check your on-prem firewalls and routes. The subnet of the web app is going to be different to that of the VM that can talk to your on prem network - so you&amp;#39;ll have to make sure routes are set up for the P2S subnet.&lt;br /&gt;&lt;br /&gt;Good luck!</content>
    </comment>
  </comments>
  <viewCount>0</viewCount>
</post>