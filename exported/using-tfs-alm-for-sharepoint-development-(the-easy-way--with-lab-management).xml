<?xml version="1.0" encoding="utf-8"?>
<post>
  <id>03f2e264-d1f3-4673-8865-b266e7e70580</id>
  <title>Using TFS ALM for Sharepoint Development (The Easy Way – with Lab Management)</title>
  <slug>using-tfs-alm-for-sharepoint-development-(the-easy-way--with-lab-management)</slug>
  <shortUrl>http://bit.ly/1koDIjI</shortUrl>
  <author>Colin Dembovsky</author>
  <pubDate>2012-02-10 12:46:00</pubDate>
  <lastModified>2020-04-04 04:15:39</lastModified>
  <content>&lt;div dir="ltr" style="text-align: left;" trbidi="on"&gt;Visual Studio 2010 has some amazing features for Sharepoint development, like project templates, server explorers, feature and package GUIs to name a few. So you’re tasked with creating a WebPart or a Workflow – no problem, fire up VS, create a new project and you’re coding.&lt;br /&gt;However, just because you’re up and coding quickly, doesn’t mean you’re being productive (necessarily). What about requirements management? Testing? Source control? And if there’s more than 1 of you coding, what Sharepoint site do you code against? Oh wait, I forgot to mention that you need to install Sharepoint on the same machine that you have VS on to actually get the Sharepoint projects to work.&lt;br /&gt;&lt;h2&gt;The Challenges&lt;/h2&gt;There are a few challenges that you’ll need to overcome if you want to be a good ALM citizen while doing Sharepoint dev:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Sharepoint and VS need to be on the same machine&lt;/li&gt;&lt;li&gt;Source code needs to go somewhere other than your hard drive&lt;/li&gt;&lt;li&gt;Build Automation&lt;/li&gt;&lt;li&gt;Deployment&lt;/li&gt;&lt;li&gt;Automated Testing&lt;/li&gt;&lt;/ul&gt;Fortunately, without too much work, you can address all of these challenges using TFS, and specifically Lab Management. Of course TFS covers the other ALM concerns too (like requirements management and bug tracking). I won’t focus on these too much in this article; I’ll concentrate more on the “technical challenges” bulleted above.&lt;br /&gt;&lt;h2&gt;Setting up a Dev Environment using a VM&lt;/h2&gt;Installing Sharepoint on your local machine will allow you to at least get your applications compiling, but it’s not a sustainable solution to the SP/VS-on-the-same-machine problem. I decided to use a VM. Here are the steps I followed to set up the VM for development:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Install OS and join domain&lt;/li&gt;&lt;li&gt;Install and configure Sharepoint&lt;/li&gt;&lt;li&gt;Install VS and connect to TFS&lt;/li&gt;&lt;li&gt;Snapshot&lt;/li&gt;&lt;/ul&gt;Now I have a VM for Sharepoint development. I can easily duplicate this VM for other team members as they need development environments.&lt;br /&gt;Note: Because this VM is going to also become a test environment, I was careful to add my solution to Source Control. That way if I restored to a previous snapshot I don’t lose any code!&lt;br /&gt;&lt;h2&gt;Build Automation&lt;/h2&gt;Building the code in TeamBuild is easy – but you’ll have to jump through some extra hoops if you want to create a WSP that can be deployed to your test Sharepoint.&lt;br /&gt;Chris O’Brien (from the Sharepoint Dev Team) wrote a series of blogs about Continuous Integration with TFS and Sharepoint (supposedly there are 5 posts, but I only found 3: &lt;a href="http://blogs.msdn.com/b/sharepointdev/archive/2011/08/25/creating-your-first-tfs-build-process-for-sharepoint-projects.aspx"&gt;one&lt;/a&gt;, &lt;a href="http://blogs.msdn.com/b/sharepointdev/archive/2011/09/22/configuring-versioning-of-assemblies-in-sharepoint-automated-build.aspx"&gt;three&lt;/a&gt; and &lt;a href="http://blogs.msdn.com/b/sharepointdev/archive/2011/11/17/deploying-wsps-as-part-of-an-automated-build.aspx"&gt;five&lt;/a&gt;). They’re certainly detailed – but it seemed like a lot of work to go through. I think that my Lab Management solution overcomes some of the complexities that Chris had to work through (most of which revolved around remote deployment of WSP’s).&lt;br /&gt;To get automated builds working, start off using the DefaultTemplate and get the build to compile your solution. Once you get a passed build, it’s time to create the WSP package. So open up the build template and add&lt;br /&gt;&lt;span style="font-family: Courier New;"&gt;/p:IsPackage=true&lt;/span&gt;&lt;br /&gt;to the MSBuild arguments parameter.&lt;br /&gt;&lt;a href="http://lh6.ggpht.com/-ew0gqU5DhHs/TzT1LAaZVMI/AAAAAAAAAWY/Czz7p9kdSKY/s1600-h/image%25255B3%25255D.png"&gt;&lt;img alt="image" border="0" height="267" src="http://lh6.ggpht.com/-EG9Kiid9yR8/TzT1NEsl-cI/AAAAAAAAAWg/Bcw1WzSkl7M/image_thumb%25255B1%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="343" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;However, your build is now going to fail (unless you have Sharepoint installed on your build server – which you shouldn’t!). The Sharepoint packaging requires some build targets as well as some dll’s that only get installed with Sharepoint.&lt;br /&gt;One of the most useful bits of info in Chris O’Brien’s articles is the mention of &lt;a href="http://archive.msdn.microsoft.com/SPPwrShllTeamBuild"&gt;this Powershell script&lt;/a&gt; that will “harvest” the Sharepoint dll’s and build targets and then “install” them on your build server. I ran the script (1st on the Sharepoint dev VM), copied over the folder it created to the build server and ran the script again to install. Easy as pie. Trigger another build, and you’ll see in the drop folder a shiny new WSP package!&lt;br /&gt;&lt;h2&gt;Deployment&lt;/h2&gt;Deploying your WSP to the Sharepoint site is arguable the most difficult challenge that you’ll face. That’s why Chris O’Brien’s article gets quite complicated. Enter Lab Management.&lt;br /&gt;Since we’re working off a VM anyway, let’s bring it into Lab Management. The workflow capability (provided by the TeamBuild agent) will allow us to automate deployment not from a remote perspective, but “locally” as it were (we’re going to execute the deployment from the Sharepoint machine, not remotely from the build server). This is a massive simplification.&lt;br /&gt;These are the steps I followed to enable deployment:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Install the TFS Build, Lab and Test agents on the Sharepoint Dev VM&lt;/li&gt;&lt;ul&gt;&lt;li&gt;I configured the Build and Test agents, hooking them up to existing Build and Test controllers in my TFS environment&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Compose a new Virtual Environment in Lab Management&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Bring in the Sharepoint VM and enable Deployment and Testing capabilities&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;a href="http://lh6.ggpht.com/-WIvWKQL5Cc4/TzT1Oq2_ffI/AAAAAAAAAWo/H7ouzITP4-o/s1600-h/image%25255B9%25255D.png"&gt;&lt;img alt="image" border="0" height="157" src="http://lh3.ggpht.com/-F0z39yVhcF0/TzT1QAwWMnI/AAAAAAAAAWw/qF2HN6XzyUc/image_thumb%25255B3%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="244" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Use VS to deploy the package to the Sharepoint site  by debugging the project&lt;/li&gt;&lt;ul&gt;&lt;li&gt;In the Sharepoint Tab of the Sharepoint project properties, make sure you turn off the “Auto-retract after debug” option&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;a href="http://lh3.ggpht.com/-CNwzt6mgjK8/TzT1RW9RKvI/AAAAAAAAAW4/DCOxfT6DdTs/s1600-h/image%25255B6%25255D.png"&gt;&lt;img alt="image" border="0" height="244" src="http://lh3.ggpht.com/-jSs-UwwBDqY/TzT1TIZekCI/AAAAAAAAAXA/nseLctO1QDM/image_thumb%25255B2%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="228" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Create a custom page to add the WebPart in (this is only necessary for visual development, like WebParts)&lt;/li&gt;&lt;li&gt;Create a Powershell script that can update the WSP (here’s &lt;a href="https://skydrive.live.com/?cid=64A24E0938D6D062&amp;id=64A24E0938D6D062%21312"&gt;mine&lt;/a&gt; – it’s pretty generic, so should just work)&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Add this to the Sharepoint project and set its “Copy to output directory” property to “Copy always” (this ensures that it ends up in the drop folder)&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2&gt;Coded UI Testing&lt;/h2&gt;I’m not going to go into too much detail here – I created a test plan and a test suite. I then created a test case and executed the case (with Action Recording enabled). I then added a Test Project to my Sharepoint solution and generated a coded UI test from the Test Case action recording. Then I associated the test method to the Test Case (in the Associated Automation tab of the test case). Voila – one automated test case ready to fire.&lt;br /&gt;You’ll need to open MTM and create Test Settings (automated in this case) for your Sharepoint Lab environment.&lt;br /&gt;&lt;h2&gt;Lab Management Workflow&lt;/h2&gt;The final step is hooking it all up in the Lab Management workflow. Create a new build and change the template to the LabDefaultTemplate. Click the ellipsis to launch the Lab Workflow Wizard.&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Environments Tab: Select the Sharepoint environment from the list of environments&lt;/li&gt;&lt;li&gt;Build Tab: Select the build that you created using the DefaultTemplate and that builds your WSP package&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Note: The coded UI test project must be part of this solution too, so that the dll’s end up in the drop folder&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Deploy Tab: check the “Deploy the build” checkbox&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Add the following 2 scripts (make sure you create the c:\deployment folder on the VM):&lt;/li&gt;&lt;li&gt;&lt;span style="font-family: Courier New;"&gt;cmd /c xcopy /Y $(BuildLocation)\*.* c:\deployment&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style="font-family: Courier New;"&gt;cmd /c powershell c:\deployment\deployWSP.ps1 $(BuildLocation)&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;a href="http://lh5.ggpht.com/-Y2Ld1FDSSMU/TzT1UX2HWOI/AAAAAAAAAXI/mLT0v8LksFg/s1600-h/image%25255B13%25255D.png"&gt;&lt;img alt="image" border="0" height="178" src="http://lh4.ggpht.com/-JBRRCsfsYNU/TzT1WTuG6GI/AAAAAAAAAXQ/94WB3zFxwCg/image_thumb%25255B5%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="313" /&gt;&lt;/a&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Test Tab: Select the test plan, suite, configuration and settings&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Conclusion&lt;/h2&gt;Using Lab Management greatly simplifies the ALM aspects of Sharepoint development – automated build, deployment and testing specifically.&lt;br /&gt;Summary of Steps:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Create a VM and install Sharepoint and VS 2010&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Create your SP solution and &lt;em&gt;check into Source control!&lt;/em&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Install and configure TFS Build, Test and Lab agents&lt;/li&gt;&lt;li&gt;Compose a new Environment using the VM&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Create automated test settings for the environment&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Deploy the package by debugging the project (turn off auto-retract after debugging)&lt;/li&gt;&lt;li&gt;Create test cases in a test plan&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Execute them using the Action Recording&lt;/li&gt;&lt;li&gt;Turn the action recordings into Coded UI Tests&lt;/li&gt;&lt;li&gt;Associate the test methods to the Test Cases&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Customize the build to produce a WSP package&lt;/li&gt;&lt;ul&gt;&lt;li&gt;This includes “installing” Sharepoint dlls and build targets onto your build server&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Create a powershell script that can update the deployed Package from a WSP file&lt;/li&gt;&lt;li&gt;Hook it all up using the Lab Management Workflow&lt;/li&gt;&lt;/ul&gt;&lt;a href="http://lh6.ggpht.com/-LDp9BCuUWNc/TzT1XpF_2RI/AAAAAAAAAXY/xr4j3yGy8BE/s1600-h/image%25255B17%25255D.png"&gt;&lt;img alt="image" border="0" height="274" src="http://lh3.ggpht.com/-Oy3iLHxD360/TzT1ZPl6rvI/AAAAAAAAAXg/jyrem8Ncc8w/image_thumb%25255B7%25255D.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="288" /&gt;&lt;/a&gt;&lt;br /&gt;Happy SP dev’ing!&lt;/div&gt;</content>
  <ispublished>true</ispublished>
  <categories>
    <category>ALM</category>
  </categories>
  <comments>
    <comment isAdmin="false" isApproved="true" id="de46d1ec-8ced-49d9-84d5-354af8ad8bc9">
      <author>Jose Clayton</author>
      <email>noreply@blogger.com</email>
      <website>http://josephyoung.webstarts.com/</website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2012-04-30 11:36:26</date>
      <content>I am very pleased to find this blog. I want to thank for your time for this wonderful read!!! Keep Sharing, I'll surely be looking for more.</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="d2aadc65-8ce9-4fdb-9608-1b78c40f9523">
      <author>Colin Dembovsky</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/02577890234096457646</website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2012-04-30 11:51:50</date>
      <content>It's a pleasure Jose - I am glad you find my posts useful!</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="ba9f76fc-e27f-4ca7-8ace-b7ab9c7c3727">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website></website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2012-09-19 09:27:04</date>
      <content>Hi Colin&lt;br /&gt;&lt;br /&gt;Thanks for the blog, can you correct this expression /p:IsPacakge=true. There is a little misspelling :)</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="c721b10c-9716-4502-a11f-34141006b977">
      <author>Colin Dembovsky</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/02577890234096457646</website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2012-09-19 10:47:36</date>
      <content>This comment has been removed by the author.</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="0d348e08-eb64-4050-b730-164c30679524">
      <author>Colin Dembovsky</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/02577890234096457646</website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2012-09-19 10:48:57</date>
      <content>Done - thanks for spotting it!</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="499cdd78-8496-416d-b37d-72ef2b3e5870">
      <author>Rajah Vasquez</author>
      <email>noreply@blogger.com</email>
      <website>http://waynereilly.snappages.com/blog/2013/05/30/sharepoint-developers-have-adopted-different-practices-to-create-useful-and-highly-effective-applications</website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2013-06-04 06:39:54</date>
      <content>This is really a nice blog with great post, I would really like to keep reading here. Thanks for this nice article.</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="1ede9cd8-daec-47bf-a800-bd9523b9c0a8">
      <author>Matthew Fox</author>
      <email>noreply@blogger.com</email>
      <website>http://aldenlindsey.livejournal.com/724.html</website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2013-06-26 05:54:50</date>
      <content>Awesome weblog with excellent publish, I would really like to continue studying here. Thanks for this awesome content.</content>
    </comment>
  </comments>
  <viewCount>2158</viewCount>
</post>