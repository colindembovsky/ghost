<?xml version="1.0" encoding="utf-8"?>
<post>
  <id>6cfecdf7-7faf-4532-aeff-28b425326e56</id>
  <title>IntelliTrace Tips and Tricks: IntelliTrace Everywhere</title>
  <slug>intellitrace-tips-and-tricks-intellitrace-everywhere</slug>
  <shortUrl>http://bit.ly/1fy1GeS</shortUrl>
  <author>Colin Dembovsky</author>
  <pubDate>2013-06-18 14:35:00</pubDate>
  <lastModified>2020-04-08 17:25:12</lastModified>
  <content>&lt;p&gt;Series Links:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;&lt;a href="http://www.colinsalmcorner.com/2013/06/intellitrace-tips-and-tricks-basics.html" target="_blank"&gt;Part 1&lt;/a&gt;: The Basics (this post) – also &lt;a href="http://blogs.msdn.com/b/southafrica/archive/2013/05/13/guest-post-intellitrace-tips-and-tricks-the-basics-part-1-colin-dembovsky.aspx" target="_blank"&gt;guest posted&lt;/a&gt; on MSDevDiv SA Blog&lt;/li&gt; &lt;li&gt;&lt;a href="http://www.colinsalmcorner.com/2013/06/intellitrace-tips-and-tricks.html" target="_blank"&gt;Part 2&lt;/a&gt;: IntelliTrace Everywhere – also &lt;a href="http://blogs.msdn.com/b/southafrica/archive/2013/05/13/guest-post-intellitrace-tips-and-tricks-intellitrace-everywhere-part-2-colin-dembovsky.aspx" target="_blank"&gt;guest posted&lt;/a&gt; on MSDevDiv SA Blog&lt;/li&gt; &lt;li&gt;&lt;a href="http://www.colinsalmcorner.com/2013/04/enable-custom-intellitrace-web-events.html" target="_blank"&gt;Part 3&lt;/a&gt;: Enable Custom IntelliTrace Events with a Right-Click&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;In my previous post I showed you how to enable IntelliTrace for debugging – F5 IntelliTrace. That’s all well and good, but what about getting IntelliTrace logs from your test environments? Or from production?&lt;/p&gt; &lt;p&gt;Here’s where you can use IntelliTrace:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;.NET 2.0 and above managed code (note: the collector requires .NET 3.5, so you’ll need that on the target server even if you app is in .NET 2.0)  &lt;li&gt;Enable the IntelliTrace diagnostic adapter in Test Manager to collect logs during test runs  &lt;li&gt;IIS: Use PowerShell to attach to an application pool and collect logs  &lt;li&gt;Desktop Apps: Use IntelliTraceSC.exe to launch an app and collect logs  &lt;li&gt;Windows Services: This one is tough, but possible. Involves some registry tweaking. &lt;a href="http://blogs.msdn.com/b/msaffer/archive/2011/02/23/using-intellitrace-with-services.aspx" target="_blank"&gt;Read more here&lt;/a&gt;.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Here’s where you can’t collect IntelliTrace:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;Silverlight applications  &lt;li&gt;Windows Phone applications  &lt;li&gt;.NET 1 applications  &lt;li&gt;Native code applications&lt;/li&gt;&lt;/ul&gt; &lt;h2&gt;The IntelliTrace Standalone Collector&lt;/h2&gt; &lt;p&gt;You can get this from the Visual Studio installation folder, or you can &lt;a href="http://www.microsoft.com/en-za/download/details.aspx?id=30665" target="_blank"&gt;download it here&lt;/a&gt;. I recommend downloading it, since this will be the latest and greatest collector available. The page has a link to instructions about how to extract the cab file. Once you’ve expanded the cab, you’ll have the PowerShell module as well as the IntelliTraceSC.exe for collecting application data.&lt;/p&gt; &lt;h2&gt;Symbols&lt;/h2&gt; &lt;p&gt;Before we look at how to collect logs, let’s talk about symbols. In order to open up code from the iTrace logs, you’re going to need to supply symbols. Ever seen a pdb file when you compile your apps? The pdbs map source code to compiled code. But of course no self-respecting developer ever deploys pdbs, right? So if you’re not deploying your pdbs (and you shouldn’t be) then where do you put them? You get the build to publish them to a shared folder, or Symbol Server. (If you don’t use Team Build, you can simply keep your pdbs somewhere – when you open an iTrace file, you can provide the location of your pdbs).&lt;/p&gt; &lt;p&gt;Here’s an image showing where in the DefaultTemplate you can set the symbols location:&lt;/p&gt; &lt;p&gt;&lt;a href="http://lh6.ggpht.com/-e59bhWvHapQ/UcBUDNdtF4I/AAAAAAAAA7U/GxHP9U18nXQ/s1600-h/image3.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://lh4.ggpht.com/-NyIjIpNHEeU/UcBUEzKM0xI/AAAAAAAAA7c/GakVNgEfig8/image_thumb1.png?imgmax=800" width="408" height="240"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;One more thing – you’ll need to set this location in the Debugging options of VS in order for it to look there for the symbols. In VS, go to the Tools-&gt;Options dialog. Then expand the Debugging-&gt;Symbols section. There are some buttons in the top right of the dialog – click the “New Location” icon (between the yellow warning icon and the ‘x’ button) and type in the same directory that you used in the Build Process settings (above).&lt;/p&gt; &lt;p&gt;&lt;a href="http://lh3.ggpht.com/-V1o2CHUMfBM/UcBUF-6jEwI/AAAAAAAAA7k/WgOXVh1MTrU/s1600-h/image5.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://lh4.ggpht.com/-yVR_FFUbXEU/UcBUHp9xD7I/AAAAAAAAA7s/xAfbEXcRiWc/image_thumb2.png?imgmax=800" width="429" height="276"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;You’ll also need to open the “General” tab under Debugging and set the following checkboxes:&lt;/p&gt; &lt;p&gt;&lt;a href="http://lh4.ggpht.com/-ObB1izF-F-Y/UcBUIrOlUPI/AAAAAAAAA70/4oQfPrEGU4k/s1600-h/image9.png"&gt;&lt;img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://lh6.ggpht.com/-HE_KFIql3x8/UcBUKsbf7AI/AAAAAAAAA78/ZP_-4PXrA_Q/image_thumb4.png?imgmax=800" width="425" height="262"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;Now you’re ready to open the logs – let’s see how you can collect them.&lt;/p&gt; &lt;h2&gt;Collect IntelliTrace from Web Applications&lt;/h2&gt; &lt;p&gt;If you’re developing and deploying web applications, you get a lot of love from IntelliTrace. Here are the steps you’ll need to follow to start logging:&lt;/p&gt; &lt;ol&gt; &lt;li&gt;Download the IntelliTrace collector and expand it.  &lt;li&gt;Find the name (and identity) of the application pool that your web app is running under.  &lt;li&gt;Create a log folder. Make sure the app pool identity has write access to this folder.  &lt;li&gt;Open a PowerShell prompt. Go to the IntelliTrace folder. Run “Import-Module Microsoft.VisualStudio.IntellITrace.PowerShell.dll”  &lt;li&gt;To list the commands, type “Get-Command *IntelliTrace*”. This will list the 5 IntelliTrace cmdlets.  &lt;li&gt;To start logging, type&lt;/li&gt;&lt;/ol&gt; &lt;blockquote&gt; &lt;p&gt;&lt;font face="Courier New"&gt;&lt;font size="2"&gt;Start-IntelliTraceCollection –ApplicationPool &lt;strong&gt;AppPoolName&lt;/strong&gt; –CollectionPlan &lt;strong&gt;plan.xml&lt;/strong&gt; –OutputPath &lt;strong&gt;logPath&lt;/strong&gt;&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;where&lt;/p&gt; &lt;ul&gt; &lt;li&gt;AppPoolName is the name of the app pool your application is running under  &lt;li&gt;plan.xml is the collection plan (more on this in the next paragraph)  &lt;li&gt;logPath is the path you want the log files dropped into&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;The plan.xml is the settings file for what IntelliTrace events you want to collect (and if you’re running in Events Only or Events and Call Information mode). You’ll see 2 xml files in the IntelliTrace folder that ship with IntelliTrace – the lightweight collection_plan.ASP.NET.default.xml and the diagnostic collection_plan.ASP.NET.trace.xml. I recommend starting with the default plan (Events Only) and if you get stuck then dial it up to the trace plan (Events and Call Information). In the next post, I’ll show you how to customize the collection to get fine-grained control over the events.&lt;/p&gt; &lt;p&gt;Be aware that when you run Start-IntelliTraceCollection, IntelliTrace will attach itself to the app pool, but part of that will require a recycle.&lt;/p&gt; &lt;p&gt;Don’t leave this on too long – especially if you’re using the trace plan. One the collector is running, you can use the following commands when you want to grab the log and open it:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;Stop-IntelliTraceCollection – which stops the collector entirely  &lt;li&gt;Checkpoint-IntelliTraceCollection – which unlocks the log file and starts logging to a new log file&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;Use checkpoint when you want to open the log and leave the collector running (when the collector is running the file is locked by the collection process, so you won’t be able to open it).&lt;/p&gt; &lt;h2&gt;Collect IntelliTrace from Desktop Applications&lt;/h2&gt; &lt;p&gt;Collecting IntelliTrace from Desktop apps gets some love – not as much as the IIS scenario. Instead of launching your application directly, go to the IntelliTrace collector folder and run the following command:&lt;/p&gt; &lt;p&gt;&lt;font size="2" face="Courier New"&gt;IntelliTraceSC.exe help launch&lt;/font&gt;&lt;/p&gt; &lt;p&gt;to see the help on how to launch. Here’s the basic launch command:&lt;/p&gt; &lt;p&gt;&lt;font size="2" face="Courier New"&gt;IntelliTraceSC.exe launch /cp:&lt;strong&gt;plan.xml&lt;/strong&gt; /f:&lt;strong&gt;pathToLogFile&lt;/strong&gt; &lt;strong&gt;application&lt;/strong&gt;&lt;/font&gt;&lt;/p&gt; &lt;p&gt;where&lt;/p&gt; &lt;ul&gt; &lt;li&gt;plan.xml is the collection plan – use the same ones as the web collection command – don’t worry that it’s called ASP.NET – it’ll work for most default scenarios  &lt;li&gt;pathToLogFile is the full path and filename of the log file  &lt;li&gt;application is the path to the application you want to collect the log from&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;As soon as you exit your application, the logging completes and you’ll have your log file.&lt;/p&gt; &lt;p&gt;Happy logging!&lt;/p&gt;  </content>
  <ispublished>true</ispublished>
  <categories>
    <category>development</category>
  </categories>
  <comments>
    <comment isAdmin="false" isApproved="true" id="b086934f-baab-40d5-af6a-a39c0757ae41">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website></website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2014-02-13 07:19:26</date>
      <content>Can I have the itrace log file by demand without having to stop the application execution?</content>
    </comment>
    <comment isAdmin="false" isApproved="true" id="931ddb82-741b-4308-bc17-7dc81698d2d9">
      <author>Colin Dembovsky</author>
      <email>noreply@blogger.com</email>
      <website>http://www.blogger.com/profile/02577890234096457646</website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2014-02-19 15:51:49</date>
      <content>If you mean can you grab the logs without having to stop IntelliTrace collection, then yes. Use the "CheckPoint-IntelliTraceCollection" cmdlet. If you've got the Microsoft Monitoring Agent installed, then the cmdlet is "CheckPoint-WebApplicationMonitoring".&lt;br /&gt;&lt;br /&gt;If you mean can you start collecting logs without recycling the application pool, unfortunately the answer is no. However, you can install the Microsoft Monitoring Agent (MMA) and run it in "Monitor" mode - this will only collect errors and some performance events - it's lightweight enough to leave on permanently. You then checkpoint the log occasionally to see if there are any errors.</content>
    </comment>
  </comments>
  <viewCount>6814</viewCount>
</post>