<?xml version="1.0" encoding="utf-8"?>
<post>
  <id>00d81fe4-a4a9-48c0-897f-637154028e22</id>
  <title>Unit Testing Javascript in VS 2012</title>
  <slug>unit-testing-javascript-in-vs-2012</slug>
  <shortUrl>http://bit.ly/1koK4zB</shortUrl>
  <author>Colin Dembovsky</author>
  <pubDate>2012-07-23 12:24:00</pubDate>
  <lastModified>2020-04-05 19:51:11</lastModified>
  <content>&lt;p&gt;You’re a responsible developer – you write code, and then you write tests (or, perhaps you even write tests and then write code?). You also love good, solid frameworks that separate concerns and utilize dependency injection and inversion of control and all of that good stuff – you’re using MVC for your web applications.&lt;/p&gt; &lt;p&gt;But you have a little problem – your pages use Javascript, and that’s difficult to unit test, right? Not any more.&lt;/p&gt; &lt;h2&gt;The Sample Solution&lt;/h2&gt; &lt;p&gt;For this post I’ll use a sample MVC app – of course, the principles apply to any client side app using Javascript, but this is an easy example to use.&lt;/p&gt; &lt;p&gt;Create a new MVC project in VS, and then add &lt;a href="http://sdrv.ms/NO71vH" target="_blank"&gt;this script&lt;/a&gt; to the Scripts folder. This script contains some Javascript for populating a country / state dropdown combo. This is the script that we’re going to be testing.&lt;/p&gt; &lt;h2&gt;Chutzpah and QUnit for MVC via NuGet&lt;/h2&gt; &lt;p&gt;You’re going to need a Javascript testing framework, and then the ability to run your tests. There are a few frameworks out there, but one I enjoy using is &lt;a href="http://docs.jquery.com/QUnit" target="_blank"&gt;QUnit&lt;/a&gt;. But that only gives you the infrastructure – you want to be able to run the tests easily too. Fortunately, VS 2012’s Test Explorer is extensible, so you can add your own “test adapters”. And there’s already one by Matthew Manela for Javascript testing with QUnit called Chutzpah (there is a &lt;a href="http://chutzpah.codeplex.com/" target="_blank"&gt;test runner&lt;/a&gt; and a &lt;a href="http://visualstudiogallery.msdn.microsoft.com/f8741f04-bae4-4900-81c7-7c9bfb9ed1fe" target="_blank"&gt;Test Explorer extension&lt;/a&gt; – we’ll just need the extension for now). &lt;/p&gt; &lt;p&gt;Let’s create a unit test project and use &lt;a href="http://nuget.org/" target="_blank"&gt;NuGet&lt;/a&gt; to install the QUnit package.&lt;/p&gt; &lt;ol&gt; &lt;li&gt;Create a new C# Unit Test project. Delete the UnitTest1.cs file.  &lt;li&gt;Open the Package Manager Console (NuGet) and make sure the test project is set to the default project.  &lt;li&gt;Type “Install-Package QUnit-MVC” to install QUnit for MVC (this can be used to test any javascript, not just MVC).  &lt;li&gt;In the Extension Manager, search for Chutzpah and install the Test Adapter extension. Remember to restart VS once you’ve installed the extension.&lt;/li&gt;&lt;/ol&gt; &lt;p&gt;&lt;a href="http://lh5.ggpht.com/-W90N1TOLu-w/UA0mNfQyJFI/AAAAAAAAAbQ/zSOiUXw6SNA/s1600-h/image%25255B6%25255D.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/-pts2hE6n4vk/UA0mObZsnHI/AAAAAAAAAbY/HE6NwM75sfE/image_thumb%25255B2%25255D.png?imgmax=800" width="509" height="99"&gt;&lt;/a&gt;&lt;/p&gt; &lt;h2&gt;Writing Tests&lt;/h2&gt; &lt;p&gt;Let’s create a test stub for our unit test. Create a new Javascript file in the test project called “StateDropDownTests.js”. Put in the following code:&lt;/p&gt;&lt;pre class="brush: js; ruler: true;"&gt;/// &lt;reference path="../MvcApplication/Scripts/jQuery-1.6.2.js" /&gt;&lt;br /&gt;/// &lt;reference path="../MvcApplication/Scripts/StateDropDown.js" /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;module("State Dropdown Tests:")&lt;br /&gt;&lt;br /&gt;test("test States", function () {&lt;br /&gt;&lt;br /&gt;});&lt;br /&gt;&lt;/pre&gt;&lt;br /&gt;&lt;p&gt;Now open the Test Explorer and click “Run All”. You should see the test come up in the list of tests and it should fail (since nothing was tested).&lt;/p&gt;&lt;br /&gt;&lt;p&gt;&lt;a href="http://lh6.ggpht.com/-hvsCDS8D2SA/UA0mPvQ-MKI/AAAAAAAAAbg/80TVW4D7GVw/s1600-h/image%25255B10%25255D.png"&gt;&lt;img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: block; float: none; border-top-width: 0px; border-bottom-width: 0px; margin-left: auto; border-left-width: 0px; margin-right: auto; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/-e07IlfMvivc/UA0mSBLIVsI/AAAAAAAAAbo/AaE3F7MLOic/image_thumb%25255B4%25255D.png?imgmax=800" width="450" height="112"&gt;&lt;/a&gt;&lt;/p&gt;&lt;br /&gt;&lt;h2&gt;The Real Test Code&lt;/h2&gt;&lt;br /&gt;&lt;p&gt;Since the StateDropdown script we’re testing accesses objects from the DOM, you’re going to need to add some basic elements. Fortunately QUnit has hooks for adding elements into a &lt;em&gt;test fixture&lt;/em&gt;. Add the following code to the module to create the DOM element we need for testing:&lt;/p&gt;&lt;pre class="brush: js; ruler: true;"&gt;module("State Dropdown Tests:", {&lt;br /&gt;    setup: function () {&lt;br /&gt;        $("#qunit-fixture").append(&lt;br /&gt;            '&lt;select id="countrySelect" name="country"&gt;' +&lt;br /&gt;                '&lt;option value="USA"&gt;USA&lt;/option&gt;' +&lt;br /&gt;            '&lt;/select&gt;' +&lt;br /&gt;            '&lt;select id="stateSelect" name="state"&gt;' +&lt;br /&gt;            '&lt;/select&gt;'&lt;br /&gt;        );&lt;br /&gt;    }&lt;br /&gt;});&lt;br /&gt;&lt;/pre&gt;&lt;br /&gt;&lt;p&gt;Now add the following code into your test:&lt;/p&gt;&lt;pre class="brush: js; ruler: true;"&gt;test("test States", function () {&lt;br /&gt;    postCountry = '';&lt;br /&gt;    postState = '';&lt;br /&gt;&lt;br /&gt;    var stateSelect = document.getElementById('stateSelect');&lt;br /&gt;&lt;br /&gt;    // the dropdown includes all the states PLUS a 'Select State' option&lt;br /&gt;    initCountry('US');&lt;br /&gt;    equal(stateSelect.options.length, 62 + 1);&lt;br /&gt;&lt;br /&gt;    initCountry('UK');&lt;br /&gt;    equal(stateSelect.options.length, 43 + 1);&lt;br /&gt;&lt;br /&gt;    initCountry('CA');&lt;br /&gt;    equal(stateSelect.options.length, 15 + 1);&lt;br /&gt;&lt;br /&gt;    initCountry('ZA');&lt;br /&gt;    equal(stateSelect.options.length, 0 + 1);&lt;br /&gt;});&lt;br /&gt;&lt;/pre&gt;&lt;br /&gt;&lt;p&gt;Run the test – and you should see lots of green! Our test is working.&lt;/p&gt;&lt;br /&gt;&lt;p&gt;I was going to write a follow on post about getting the tests to run in TeamBuild, but Mathew Aniyan from the MS ALM team beat me to it – here’s a link to his post about &lt;font style="font-weight: normal"&gt;&lt;a href="http://blogs.msdn.com/b/visualstudioalm/archive/2012/07/09/javascript-unit-tests-on-team-foundation-service-with-chutzpah.aspx" target="_blank"&gt;Javascript Unit Tests on Team Foundation Service with Chutzpah&lt;/a&gt;&lt;/font&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Happy Javascript testing!&lt;/p&gt;  </content>
  <ispublished>true</ispublished>
  <categories>
    <category>development</category>
  </categories>
  <comments></comments>
  <viewCount>13756</viewCount>
</post>