<?xml version="1.0" encoding="utf-8"?>
<post>
  <id>3fd7ac1d-d53d-4198-a662-945c6fe15756</id>
  <title>Using Powershell to Replace Config Settings in Lab Management</title>
  <slug>using-powershell-to-replace-config-settings-in-lab-management</slug>
  <shortUrl>http://bit.ly/1iJ4MfM</shortUrl>
  <author>Colin Dembovsky</author>
  <pubDate>2011-06-16 13:49:00</pubDate>
  <lastModified>2020-04-06 01:15:52</lastModified>
  <content>&lt;p&gt;So you’ve got your virtual environment running and you’re deploying your application using the Lab Default Workflow. Only, you have a config file and you need to update a connection string or something in the config file for automated tests to run properly.&lt;/p&gt; &lt;p&gt;Now if you’re deploying websites, for goodness sake use &lt;a href="http://www.iis.net/download/WebDeploy" target="_blank"&gt;WebDeploy&lt;/a&gt;  and the Web.Config transforms within Visual Studio to configure your web.configs as part of the WebDeploy packaging. This is by far the easiest way to deploy web applications into lab environments.&lt;/p&gt; &lt;p&gt;However, if you’ve got some other configs that need to be twiddled as part of the deployment, then create a PowerShell script to do your replacements.&lt;/p&gt; &lt;p&gt;Given an XML that looks like this:&lt;/p&gt;&lt;pre class="code"&gt;&lt;span style="color: blue"&gt;&lt;&lt;/span&gt;&lt;span style="color: #a31515"&gt;configuration&lt;/span&gt;&lt;span style="color: blue"&gt;&gt;&lt;br /&gt;  &lt;&lt;/span&gt;&lt;span style="color: #a31515"&gt;settings &lt;/span&gt;&lt;span style="color: red"&gt;LogTraceInfo&lt;/span&gt;&lt;span style="color: blue"&gt;=&lt;/span&gt;"&lt;span style="color: blue"&gt;False&lt;/span&gt;" &lt;span style="color: red"&gt;KeepConnectionAlive&lt;/span&gt;&lt;span style="color: blue"&gt;=&lt;/span&gt;"&lt;span style="color: blue"&gt;True&lt;/span&gt;"&lt;span style="color: blue"&gt;&gt;&lt;br /&gt;    &lt;&lt;/span&gt;&lt;span style="color: #a31515"&gt;sql &lt;/span&gt;&lt;span style="color: red"&gt;server&lt;/span&gt;&lt;span style="color: blue"&gt;=&lt;/span&gt;"&lt;span style="color: blue"&gt;dbserver&lt;/span&gt;" &lt;span style="color: red"&gt;database&lt;/span&gt;&lt;span style="color: blue"&gt;=&lt;/span&gt;"&lt;span style="color: blue"&gt;Live&lt;/span&gt;" &lt;span style="color: blue"&gt;/&gt;&lt;br /&gt;  &lt;/&lt;/span&gt;&lt;span style="color: #a31515"&gt;settings&lt;/span&gt;&lt;span style="color: blue"&gt;&gt;&lt;br /&gt;&lt;/&lt;/span&gt;&lt;span style="color: #a31515"&gt;configuration&lt;/span&gt;&lt;span style="color: blue"&gt;&gt;&lt;/span&gt;&lt;/pre&gt;&lt;br /&gt;&lt;p&gt;Let’s say you want to replace the database property. Here’s the PS to do this:&lt;/p&gt;&lt;br /&gt;&lt;p&gt;&lt;span style="color: green"&gt;######################################################################################&lt;br&gt;#&lt;br&gt;# Usage: ReplaceDatabaseInConfig.ps1 -configPath "path to config" -database "new database name"&lt;br&gt;#&lt;br&gt;######################################################################################&lt;br&gt;&lt;/span&gt;&lt;span style="color: blue"&gt;param&lt;/span&gt;&lt;span style="color: black"&gt;(&lt;/span&gt;&lt;span style="color: purple"&gt;$configPath&lt;/span&gt;&lt;span style="color: black"&gt;, &lt;/span&gt;&lt;span style="color: purple"&gt;$database&lt;/span&gt;&lt;span style="color: black"&gt;)&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span style="color: #5f9ea0"&gt;Write-Host &lt;/span&gt;&lt;span style="color: maroon"&gt;"Replacing database name in config file..."&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span style="color: green"&gt;# Get the content of the config file and cast it to XML&lt;br&gt;&lt;/span&gt;&lt;span style="color: purple"&gt;$xml &lt;/span&gt;&lt;span style="color: red"&gt;= &lt;/span&gt;&lt;span style="color: black"&gt;[&lt;/span&gt;&lt;span style="color: teal"&gt;xml&lt;/span&gt;&lt;span style="color: black"&gt;](&lt;/span&gt;&lt;span style="color: #5f9ea0"&gt;get-content &lt;/span&gt;&lt;span style="color: purple"&gt;$configPath&lt;/span&gt;&lt;span style="color: black"&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style="color: purple"&gt;$root &lt;/span&gt;&lt;span style="color: red"&gt;= &lt;/span&gt;&lt;span style="color: purple"&gt;$xml&lt;/span&gt;&lt;span style="color: black"&gt;.get_DocumentElement();&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span style="color: green"&gt;# change the db name&lt;br&gt;&lt;/span&gt;&lt;span style="color: purple"&gt;$root&lt;/span&gt;&lt;span style="color: black"&gt;.settings.sql.database &lt;/span&gt;&lt;span style="color: red"&gt;= &lt;/span&gt;&lt;span style="color: purple"&gt;$database&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span style="color: green"&gt;#save&lt;br&gt;&lt;/span&gt;&lt;span style="color: purple"&gt;$xml&lt;/span&gt;&lt;span style="color: black"&gt;.Save(&lt;/span&gt;&lt;span style="color: purple"&gt;$configPath&lt;/span&gt;&lt;span style="color: black"&gt;)&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span style="color: #5f9ea0"&gt;Write-Host &lt;/span&gt;&lt;span style="color: maroon"&gt;"Done!"&lt;/span&gt;&lt;/p&gt;&lt;pre class="code"&gt;&lt;span style="color: green"&gt;###########################################################################&lt;/span&gt;&lt;/pre&gt;&lt;br /&gt;&lt;p&gt;Check this script into Source Control – make sure that you get it into your drop folder somehow (add it to a solution and mark it’s action to “Copy Always” or something along those lines).&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Then it’s a simple matter of executing the script as part of your deployment. If you set the working directory to the folder where your deployment copies the script, then you can invoke it as follows:&lt;/p&gt;&lt;br /&gt;&lt;p&gt;&lt;font face="Courier New"&gt;cmd /c powershell .\ReplaceDatabaseInConfig.ps1 -configPath "AppCustom.config" -database "Live"&lt;/font&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;In your build log, you’ll see the following:&lt;/p&gt;&lt;br /&gt;&lt;p&gt;&lt;a href="http://lh4.ggpht.com/-c0Q-urMxhoE/TfntvqukHII/AAAAAAAAAQs/mB_SyVAIydA/s1600-h/image%25255B3%25255D.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/-Tc62CFoLl04/TfntwF5AKJI/AAAAAAAAAQw/YpW_GFUSe_I/image_thumb%25255B1%25255D.png?imgmax=800" width="460" height="90"&gt;&lt;/a&gt;&lt;/p&gt;&lt;br /&gt;&lt;p&gt;Happy testing!&lt;/p&gt;  </content>
  <ispublished>true</ispublished>
  <categories>
    <category>Lab Management</category>
  </categories>
  <comments>
    <comment isAdmin="false" isApproved="true" id="39692c58-eeac-4981-be5f-ee07b57628fc">
      <author>Anonymous</author>
      <email>noreply@blogger.com</email>
      <website></website>
      <ip></ip>
      <userAgent></userAgent>
      <date>2012-08-06 08:7:15</date>
      <content>A work mate referred me to your resource. Thnx for &lt;br /&gt;the details.&lt;br /&gt;&lt;i&gt;my web site&lt;/i&gt; :: &lt;b&gt;&lt;a href="http://decalstickerremover.com" rel="nofollow"&gt;Remove Decals&lt;/a&gt;&lt;/b&gt;</content>
    </comment>
  </comments>
  <viewCount>1969</viewCount>
</post>